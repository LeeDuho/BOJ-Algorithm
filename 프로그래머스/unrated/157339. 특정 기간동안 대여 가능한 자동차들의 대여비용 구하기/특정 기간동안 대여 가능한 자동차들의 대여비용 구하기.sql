-- 코드를 입력하세요
SELECT A.CAR_ID, A.CAR_TYPE, ROUND(A.DAILY_FEE * 30 * (100-B.DISCOUNT_RATE)/100,0) AS FEE 
FROM CAR_RENTAL_COMPANY_CAR A
INNER JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN B
ON A.CAR_TYPE = B.CAR_TYPE
WHERE
    A.CAR_ID NOT IN 
        (SELECT CAR_ID
        FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
        WHERE 
            END_DATE >= '2022-11-01'
        AND
            START_DATE < '2022-12-01'
        # WHERE 
        #     (START_DATE >= '2022-11-01'
        #     AND START_DATE <= '2022-11-30')
        #     OR
        #     (END_DATE >= '2022-11-01'
        #     AND END_DATE <= '2022-11-30')
        # )
         )
AND (A.CAR_TYPE = '세단' OR A.CAR_TYPE = 'SUV')
AND B.DURATION_TYPE = '30일 이상'
GROUP BY
    A.CAR_ID
HAVING
    FEE BETWEEN 500000 AND 1999999
# AND ROUND(A.DAILY_FEE * 30 * ((100-B.DISCOUNT_RATE)/100),0) >=500000 
# AND ROUND(A.DAILY_FEE * 30 * ((100-B.DISCOUNT_RATE)/100),0) <2000000
# AND FEE >=500000 AND FEE <2000000
ORDER BY FEE DESC, A.CAR_TYPE ASC, A.CAR_ID DESC